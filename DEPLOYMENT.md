# üöÄ Deployment Guide - Office Ping Pong Tracker

This guide will walk you through deploying your Ping Pong Tracker application to Render.

## Prerequisites

1. A [GitHub](https://github.com) account
2. A [Render](https://render.com) account (free tier available)
3. Your code committed to a GitHub repository

## Step 1: Push Code to GitHub

If you haven't already created a GitHub repository:

1. Go to [GitHub](https://github.com/new) and create a new repository
2. Copy the repository URL (e.g., `https://github.com/yourusername/ping-pong-tracker.git`)
3. Run these commands in your terminal:

```bash
git remote add origin https://github.com/yourusername/ping-pong-tracker.git
git branch -M main
git push -u origin main
```

## Step 2: Deploy to Render

### Option A: Deploy Using render.yaml (Recommended)

1. **Go to Render Dashboard**
   - Visit [https://dashboard.render.com](https://dashboard.render.com)
   - Click "New" ‚Üí "Blueprint"

2. **Connect Your Repository**
   - Select your GitHub repository
   - Render will automatically detect the `render.yaml` file

3. **Configure the Blueprint**
   - Review the services that will be created:
     - `ping-pong-api` (Backend API)
     - `ping-pong-client` (Frontend)

4. **Set Environment Variables**
   - Render will auto-generate the `JWT_SECRET`
   - You may need to update `VITE_API_URL` in the frontend service after backend is deployed

5. **Deploy**
   - Click "Apply" to start the deployment
   - Wait for both services to deploy (5-10 minutes)

6. **Update Frontend Environment**
   - After backend deploys, note its URL (e.g., `https://ping-pong-api.onrender.com`)
   - Go to the frontend service settings
   - Update `VITE_API_URL` to `https://ping-pong-api.onrender.com/api`
   - Trigger a manual deploy of the frontend

7. **Update Backend CORS**
   - Go to backend service settings
   - Add environment variable `FRONTEND_URL` with your frontend URL (e.g., `https://ping-pong-client.onrender.com`)
   - Redeploy the backend

### Option B: Manual Service Creation

If you prefer to set up services manually:

#### Backend Service

1. Click "New" ‚Üí "Web Service"
2. Connect your repository
3. Configure:
   - **Name**: `ping-pong-api`
   - **Runtime**: Node
   - **Build Command**: `cd server && npm install`
   - **Start Command**: `cd server && npm start`
   - **Environment Variables**:
     ```
     NODE_ENV=production
     PORT=3001
     JWT_SECRET=<generate-a-random-secret>
     JWT_EXPIRES_IN=7d
     FRONTEND_URL=<will-add-after-frontend-deploys>
     ```
4. **Add Persistent Disk**:
   - Click "Add Disk"
   - Name: `ping-pong-data`
   - Mount Path: `/opt/render/project/src/server/data`
   - Size: 1 GB
5. Click "Create Web Service"

#### Frontend Service

1. Click "New" ‚Üí "Static Site"
2. Connect your repository
3. Configure:
   - **Name**: `ping-pong-client`
   - **Build Command**: `cd client && npm install && npm run build`
   - **Publish Directory**: `./client/dist`
   - **Environment Variables**:
     ```
     VITE_API_URL=https://ping-pong-api.onrender.com/api
     ```
4. **Add Rewrite Rule** (for React Router):
   - Source: `/*`
   - Destination: `/index.html`
5. Click "Create Static Site"

## Step 3: Verify Deployment

1. **Test the Backend**
   - Visit `https://your-backend-url.onrender.com/health`
   - You should see: `{"status":"ok","timestamp":"..."}`

2. **Test the Frontend**
   - Visit your frontend URL
   - You should see the login/register page
   - Try creating an account
   - Record a test game

## Step 4: First Time Setup

1. **Create Your Account**
   - Navigate to your deployed frontend URL
   - Click "Register"
   - Create an account with your name as the player name

2. **Invite Your Colleagues**
   - Share the URL with your office
   - Each person creates their own account
   - Start recording games!

## Environment Variables Reference

### Backend (`ping-pong-api`)

| Variable | Description | Example |
|----------|-------------|---------|
| `NODE_ENV` | Environment mode | `production` |
| `PORT` | Server port | `3001` |
| `JWT_SECRET` | Secret key for JWT tokens | Auto-generated by Render |
| `JWT_EXPIRES_IN` | Token expiration time | `7d` |
| `FRONTEND_URL` | Frontend URL for CORS | `https://ping-pong-client.onrender.com` |

### Frontend (`ping-pong-client`)

| Variable | Description | Example |
|----------|-------------|---------|
| `VITE_API_URL` | Backend API URL | `https://ping-pong-api.onrender.com/api` |

## Troubleshooting

### Backend Won't Start

1. Check the logs in Render dashboard
2. Ensure all environment variables are set correctly
3. Verify the disk is mounted correctly at `/opt/render/project/src/server/data`

### Frontend Can't Connect to Backend

1. Verify `VITE_API_URL` is set correctly
2. Check that backend service is running
3. Ensure `FRONTEND_URL` is set in backend environment variables
4. Check browser console for CORS errors

### Database Issues

1. Ensure persistent disk is attached to backend service
2. Check backend logs for migration errors
3. The database will be created automatically on first run

### "Failed to Create Game" Errors

1. Ensure you're logged in
2. Verify the backend migrations ran successfully (check logs)
3. Check that you have a player profile linked to your user account

## Free Tier Limitations

Render's free tier includes:
- 750 hours/month of runtime per service
- Services spin down after 15 minutes of inactivity
- First request after spin-down takes ~30 seconds to wake up
- 1GB persistent disk storage

**Tips for Free Tier:**
- Services will be slow on first load after inactivity
- Consider upgrading to paid tier ($7/month per service) for always-on services
- Database is persisted, so your data won't be lost

## Updating Your Deployment

To deploy updates:

1. Commit and push changes to your GitHub repository:
   ```bash
   git add .
   git commit -m "Your update message"
   git push origin main
   ```

2. Render will automatically detect the push and redeploy both services

3. Monitor the deployment in the Render dashboard

## Custom Domain (Optional)

To use a custom domain:

1. Go to your frontend service settings in Render
2. Click "Custom Domain"
3. Follow the instructions to add your domain
4. Update DNS records with your domain provider
5. Update `FRONTEND_URL` environment variable in backend service

## Support

If you encounter issues:

1. Check the [Render documentation](https://render.com/docs)
2. Review the application logs in Render dashboard
3. Ensure all environment variables match this guide

---

üèì **Happy Pong Tracking!**
